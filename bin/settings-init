#!/bin/bash
set -e

echo "This will install settings. Are you in composer root?"
select yn in "Yes" "No"; do
  case $yn in
      Yes ) echo "OK..."; break;;
      No ) exit;;
  esac
done

# Dirs.
targetDir=.
binDir=$(dirname $(realpath "$0"))
ourDir=$(dirname "$binDir")

set -v

# Copy our stuff.
rsync -rv "$ourDir/copyToComposerRoot/" "$targetDir/"

# Symlink our stuff.
symlinkDir=$ourDir/symlinkToComposerRoot
for relFile in $(cd $symlinkDir; find . -type f); do
  mkdir -p $(dirname $targetDir/$relFile)
  ln -rsf "$symlinkDir/$relFile" "$targetDir/$relFile"
done

# Create Hash salt.
$binDir/settings-hashsalt $targetDir/settings-project/hash_salt.php

# Pin php version to 7.0 (FSB) to prevent 7.1 packages in composer.lock.
composer config platform.php 7.0.17

# Copy container yamls.
cp web/sites/default/default.services.yml web/sites/default/services.yml

